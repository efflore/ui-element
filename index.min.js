/**
 * @name UIElement
 * @version 0.4.0
 * @license
 * Copyright 2024 Esther Brunner
 * SPDX-License-Identifier: BSD-3-Clause
 */
const t=t=>"function"==typeof t,e=(e,s=[],a=e)=>t(e)?e.call(...s):a;let s;const a=new WeakMap,n=t=>(!a.has(t)&&a.set(t,new Set),a.get(t)),r=t=>{const e={get:()=>{const a=s;s=e;const n=t();return s=a,n}};return e};export default class extends HTMLElement{attributeMapping={};#t=new Map;attributeChangedCallback(t,s,a){if(a!==s){const n=this.attributeMapping[t],[r,i]=Array.isArray(n)?n:[t,n],h={boolean:t=>"string"==typeof t,integer:t=>parseInt(t,10),number:t=>parseFloat(t)},o=e(i,[this,a,s],h[i]?h[i](a):a);this.set(r,o)}}has(t){return this.#t.has(t)}get(t){return this.has(t)&&e(this.#t.get(t).get())}set(a,i){this.has(a)?e(this.#t.get(a).set,[this,i]):this.#t.set(a,t(i)?r(i):(t=>{const a={get:()=>(s&&n(a).add(s),t),set:s=>{const r=t;t=e(s,[a,r],s),!Object.is(t,r)&&n(a).forEach((t=>t.get()))}};return a})(i))}delete(t){this.has(t)&&this.#t.delete(t)}effect(e){const s=r(e);requestAnimationFrame((()=>{const e=s.get();t(e)&&e()}))}}