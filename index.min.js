import{isFunction as t,isState as e,cause as s}from"./lib/cause-effect.js";const a="context-request",c=t=>"string"==typeof t,n=t=>parseInt(t,10),o=t=>parseFloat(t),i=t=>t;class r extends Event{context;callback;subscribe;constructor(t,e,s=!1){super(a,{bubbles:!0,cancelable:!0,composed:!0}),this.context=t,this.callback=e,this.subscribe=s}}class h extends HTMLElement{static define(t,e=customElements){try{e.get(t)||e.define(t,this)}catch(t){console.error(t)}}attributeMap={};contextMap={};#t=new Map;attributeChangedCallback(e,s,a){if(a!==s){const c=this.attributeMap[e],[n,o]=Array.isArray(c)?c:[e,c];this.set(n,t(o)?o(a,this,s):a)}}connectedCallback(){const e=Object.getPrototypeOf(this),s=e.providedContexts||[];s.length&&this.addEventListener(a,(e=>{const{context:a,callback:c}=e;s.includes(a)&&t(c)&&(e.stopPropagation(),c(this.#t.get(a)))})),setTimeout((()=>{e.consumedContexts?.forEach((e=>{const s=new r(e,(s=>{const a=this.contextMap[e],[c,n]=Array.isArray(a)?a:[e,a];this.#t.set(c||e,t(n)?n(s,this):s)}));this.dispatchEvent(s)}))}))}has(t){return this.#t.has(t)}get(e){const s=e=>t(e)?s(e()):e;return s(this.#t.get(e))}set(t,a,c=!0){if(this.#t.has(t)){const s=this.#t.get(t);c&&e(s)&&s.set(a)}else{const c=e(a)?a:s(a);this.#t.set(t,c)}}delete(t){return this.#t.delete(t)}async pass(e,a,c=customElements){await c.whenDefined(e.localName);for(const[c,n]of Object.entries(a))e.set(c,s(t(n)?n:this.#t.get(n)))}targets(t){const e=new Set;for(const s of this.#t.get(t).effects)for(const t of s.targets.keys())e.add(t);return e}}export{r as ContextRequestEvent,c as asBoolean,n as asInteger,o as asNumber,i as asString,h as default};