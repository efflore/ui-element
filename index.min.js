/**
 * @license
 * Copyright 2024 Esther Brunner
 * SPDX-License-Identifier: BSD-3-Clause
 */
let t=null;const e=new WeakMap,s=t=>"function"==typeof t,a=(t,e=[],a=t)=>s(t)?t.call(...e):a,n=t=>(!e.has(t)&&e.set(t,new Set),e.get(t));export default class extends HTMLElement{attributeMapping={};#t=new Map;attributeChangedCallback(t,e,s){if(s!==e){const n=this.attributeMapping[t],[i,r]=Array.isArray(n)?n:[t,n],l=a(r,[this,s,e],(()=>{const t={boolean:t=>"string"==typeof t,integer:t=>parseInt(t,10),number:t=>parseFloat(t)};return t[r]?t[r](s):s})());this.set(i,l)}}get(t){if(this.#t.has(t))return this.#t.get(t)()}set(e,s){if(this.#t.has(e))return a(this.#t.get(e).set,[this,s]);const i=()=>(t&&n(i).add(t),a(s));i.set=t=>{const e=a(s);(s=a(t,[null,e]))!==e&&n(i).forEach((t=>t()))},this.#t.set(e,i)}effect(e){let a=null;a||(a=requestAnimationFrame((()=>{const n=()=>{t=n;const a=e();s(a)&&setTimeout(a),t=null};n(),a=null})))}}