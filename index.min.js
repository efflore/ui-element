const t=t=>"function"==typeof t,e=(e,s=[],a=e)=>t(e)?e.call(...s):a;let s;const a=new WeakMap,n=t=>(!a.has(t)&&a.set(t,new Set),a.get(t)),r=t=>{const e={get:()=>{const a=s;s=e;const n=t();return s=a,n}};return e};export default class extends HTMLElement{attributeMap;#t=new Map;attributeChangedCallback(s,a,n){if(n!==a){const r=this.attributeMap?.get(s),[i,h]=Array.isArray(r)?r:[s,r],o={boolean:t=>"string"==typeof t,integer:t=>parseInt(t,10),number:t=>parseFloat(t)};this.set(i,e(t(h)?h:o[h],[this,n,a],n))}}has(t){return this.#t.has(t)}get(t){return this.#t.get(t)?.get()}set(a,i,h=!0){return this.#t.has(a)?h?e(this.#t.get(a).set,[this,i]):this.#t.get(a):this.#t.set(a,t(i)?r(i):(t=>{const a={get:()=>(s&&n(a).add(s),t),set:s=>{const r=t;t=e(s,[a,r],s),!Object.is(t,r)&&n(a).forEach((t=>t.get()))}};return a})(i))}delete(t){return this.#t.delete(t)}effect(t){requestAnimationFrame((()=>r(t).get()))}}