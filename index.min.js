/**
 * @name UIElement
 * @version 0.4.0
 * @license
 * Copyright 2024 Esther Brunner
 * SPDX-License-Identifier: BSD-3-Clause
 */
const t=t=>"function"==typeof t,e=(e,s=[],a=e)=>t(e)?e.call(...s):a;let s;const a=new WeakMap,n=t=>(!a.has(t)&&a.set(t,new Set),a.get(t));export const cause=t=>{const a={get:()=>(s&&n(a).add(s),t),set:s=>{const r=t;t=e(s,[a,r]),!Object.is(t,r)&&n(a).forEach((t=>t()))}};return a};export const compute=t=>({get:()=>{const e=s;s=null;const a=t();return s=e,a}});export const effect=e=>{const a=()=>{s=a;const n=e();t(n)&&setTimeout(n),s=null};a()};export default class extends HTMLElement{attributeMapping={};#t=new Map;attributeChangedCallback(t,s,a){if(a!==s){const n=this.attributeMapping[t],[r,o]=Array.isArray(n)?n:[t,n],c={boolean:t=>"string"==typeof t,integer:t=>parseInt(t,10),number:t=>parseFloat(t)},i=e(o,[this,a,s],c[o]?c[o](a):a);this.set(r,i)}}has(t){return this.#t.has(t)}get(t){return this.has(t)&&e(this.#t.get(t).get())}set(a,n){var r;this.has(a)?e(this.#t.get(a).set,[this,n]):this.#t.set(a,t(n)?(r=n,{get:()=>{const t=s;s=null;const e=r();return s=t,e}}):cause(n))}delete(t){this.has(t)&&this.#t.delete(t)}effect(e){t(e)&&requestAnimationFrame((()=>effect(e)))}}