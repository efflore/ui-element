const t=t=>e=>typeof e===t,e=t("object"),s=t("function"),n=t=>null==t,r=t=>null!=t,o=t=>r(t)&&(e(t)||s(t)),a=(t,e)=>s(t[e]),c=t=>t.nodeType!==Node.COMMENT_NODE,i=t=>n(t)?[]:[t],l=t=>({map:()=>l(t),fold:e=>e(t),catch:e=>e(t)}),u=t=>{try{return e=t(),{map:t=>u((()=>t(e))),fold:(t,s)=>s(e),catch:()=>{}}}catch(t){return l(t)}var e},h="error",f=(t,e,s="debug")=>((t=>"warn"===t||t===h)(s)&&console[s](e,t),t);let d;const p=(()=>{const t=new Map,e=new Map;let s;const n=()=>{s&&cancelAnimationFrame(s),s=requestAnimationFrame(o)},r=(t,e)=>{u(t).catch((t=>f(t,e,h)))},o=()=>{s=null;let n="Couldn't apply effect ";const o="unknown element";for(const[e,s]of t)for(const[t,a]of s)r(a,n+`${t} on ${e?.localName||o}`);t.clear(),n="Couldn't clean up after effect for ";for(const[t,s]of e)r(s,n+(t?.localName||o));e.clear()};return queueMicrotask(o),{enqueue:(e,s,r)=>{t.has(e)||t.set(e,new Map);const o=t.get(e);o.has(s)||o.set(s,r),n()},cleanup:(t,s)=>{e.has(t)||e.set(t,s),n()},flush:o}})(),g=t=>o(t)&&a(t,"set"),m=t=>g(t)||(t=>o(t)&&a(t,"run")&&"effects"in t)(t),b=t=>{const e=()=>(d&&e.effects.add(d),t);return e.effects=new Set,e.set=n=>{const r=t;t=s(n)&&!m(n)?n(t):n,Object.is(t,r)||(t=>{for(const e of t)e.run()})(e.effects)},e},y=t=>{const e=new Set,n=()=>{const r=d;let o;d=n;const a=t(((t,s,n)=>{p.enqueue(t,s,n),e.has(t)||e.add(t),o=t}));s(a)&&p.cleanup(o,a),d=r};n.run=()=>n(),n.targets=e,n()},S="context-request";class x extends Event{context;callback;subscribe;constructor(t,e,s=!1){super(S,{bubbles:!0,composed:!0}),this.context=t,this.callback=e,this.subscribe=s}}const v=(t,e)=>({elements:e,host:t,map:s=>v(t,e.map((e=>s(t,e))))}),w=t=>s(t)?w(t()):t,C=t=>t.shadowRoot||t;class N extends HTMLElement{static registry=customElements;static attributeMap={};static consumedContexts;static providedContexts;static define(t){u((()=>!this.registry.get(t)&&this.registry.define(t,this))).catch((e=>f(t,e.message,h)))}#t=new Map;attributeChangedCallback(t,e,n){if(n===e)return;const r=this.constructor.attributeMap[t];this.set(t,s(r)?r(i(n),this,e)[0]:n)}connectedCallback(){const t=this.constructor,e=t.consumedContexts||[];for(const t of e)this.set(String(t),void 0);setTimeout((()=>{for(const t of e)this.dispatchEvent(new x(t,(e=>this.set(String(t),e))))}));const n=t.providedContexts||[];n.length&&this.addEventListener(S,(t=>{const{context:e,callback:r}=t;n.includes(e)&&s(r)&&(t.stopPropagation(),r(this.#t.get(String(e))))}))}disconnectedCallback(){}has(t){return this.#t.has(t)}get(t){return w(this.#t.get(t))}set(t,e,s=!0){if(this.#t.has(t)){if(s){const s=this.#t.get(t);g(s)&&s.set(e)}}else this.#t.set(t,m(e)?e:b(e))}delete(t){return this.#t.delete(t)}self=v(this,[this]);first(t){return v(this,i(C(this).querySelector(t)))}all(t){return v(this,Array.from(C(this).querySelectorAll(t)))}signal(t){return this.#t.get(t)}}const A=t=>async(e,n)=>{await e.constructor.registry.whenDefined(n.localName);for(const[r,o]of Object.entries(t))n.set(r,m(o)?o:s(o)?b(o):e.signal(o));return n},M=(t,e,s)=>(n,r)=>(r.addEventListener(t,(t=>n.set(e,(e=>s(t,e)??e)))),r),E=t=>[r(t[0])],$=t=>t.map((t=>parseInt(t,10))).filter(Number.isFinite),k=t=>t.map(parseFloat).filter(Number.isFinite),q=t=>t,F=t=>t.map((t=>u((()=>JSON.parse(t))).fold((t=>f(void 0,`Failed to parse JSON: ${t.message}`,h)),(t=>t)))),L=(t,e,s,r,o,a,c)=>{const i=a;return t.set(e,o,!1),y((o=>{if(t.has(e)){const a=t.get(e);n(a)?o(s,r,i):o(s,r,(t=>c(t))(a))}})),s},O=t=>(e,s)=>{const n=s.textContent||"",r=t=>()=>{Array.from(s.childNodes).filter(c).forEach((t=>t.remove())),s.append(document.createTextNode(t))};return L(e,t,s,`text ${String(t)}`,n,r(n),r)},T=(t,e=t)=>(s,n)=>{const r=e=>()=>n[t]=e;return L(s,e,n,`property ${String(t)}`,n[t],r(null),r)},j=(t,e=t)=>(s,n)=>L(s,e,n,`attribute ${String(t)}`,n.getAttribute(t),(()=>n.removeAttribute(t)),(e=>()=>n.setAttribute(t,e))),D=(t,e=t)=>(s,n)=>{const r=e=>()=>n.toggleAttribute(t,e);return L(s,e,n,`attribute ${String(t)}`,n.hasAttribute(t),r(!1),r)},J=(t,e=t)=>(s,n)=>L(s,e,n,`class ${String(t)}`,n.classList.contains(t),(()=>n.classList.remove(t)),(e=>()=>n.classList.toggle(t,e))),P=(t,e=t)=>(s,n)=>L(s,e,n,`style ${String(t)}`,n.style[t],(()=>n.style.removeProperty(t)),(e=>()=>n.style[t]=String(e)));export{N as UIElement,E as asBoolean,$ as asInteger,F as asJSON,k as asNumber,q as asString,u as attempt,y as effect,f as log,i as maybe,M as on,A as pass,j as setAttribute,T as setProperty,P as setStyle,O as setText,D as toggleAttribute,J as toggleClass,v as ui};
