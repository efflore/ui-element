const t=t=>e=>typeof e===t,e=t("object"),s=t("function"),n=t=>null==t,r=t=>null!=t,o=t=>r(t)&&(e(t)||s(t)),i=(t,e)=>s(t[e]),c=t=>t.nodeType!==Node.COMMENT_NODE,a=t=>n(t)?[]:[t],u="error",l=(t,e,s="debug")=>((t=>"warn"===t||t===u)(s)&&console[s](e,t),t);let f;const{enqueue:h,cleanup:d}=(()=>{const t=new Map,e=new Map;let s;const n=()=>{s&&cancelAnimationFrame(s),s=requestAnimationFrame(o)},r=(t,e)=>{try{t()}catch(t){l(t,e,u)}},o=()=>{s=null;for(const[e,s]of t)for(const[t,n]of s)r(n,` Effect ${t} on ${e?.localName||"unknown"} failed`);t.clear();for(const t of e.values())r(t,"Cleanup failed");e.clear()};return queueMicrotask(o),{enqueue:(e,s,r)=>{t.has(e)||t.set(e,new Map);const o=t.get(e);o.has(s)||o.set(s,r),n()},cleanup:(t,s)=>{e.has(t)||e.set(t,s),n()}}})(),g=t=>o(t)&&i(t,"set"),p=t=>g(t)||(t=>o(t)&&i(t,"run")&&"effects"in t)(t),b=t=>{const e=()=>(f&&e.effects.add(f),t);return e.effects=new Set,e.set=n=>{const r=t;t=s(n)&&!p(n)?n(t):n,Object.is(t,r)||(t=>{for(const e of t)e.run()})(e.effects)},e},m=t=>{const e=new Set,n=()=>{const r=f;f=n;const o=t(((t,s,n)=>{h(t,s,n),e.has(t)||e.add(t)}));s(o)&&d(n,o),f=r};n.run=()=>n(),n.targets=e,n()},y="context-request";class S extends Event{context;callback;subscribe;constructor(t,e,s=!1){super(y,{bubbles:!0,composed:!0}),this.context=t,this.callback=e,this.subscribe=s}}const x=t=>s(t)?x(t()):t,v=t=>t.shadowRoot||t;class w extends HTMLElement{static registry=customElements;static attributeMap={};static consumedContexts;static providedContexts;static define(t){try{this.registry.get(t)||this.registry.define(t,this)}catch(e){l(t,e.message,u)}}#t=new Map;self=[this];attributeChangedCallback(t,e,n){if(n===e)return;const r=this.constructor.attributeMap[t];this.set(t,s(r)?r(a(n),this,e)[0]:n)}connectedCallback(){const t=this.constructor,e=t.consumedContexts||[];for(const t of e)this.set(String(t),void 0);setTimeout((()=>{for(const t of e)this.dispatchEvent(new S(t,(e=>this.set(String(t),e))))}));const n=t.providedContexts||[];n.length&&this.addEventListener(y,(t=>{const{context:e,callback:r}=t;n.includes(e)&&s(r)&&(t.stopPropagation(),r(this.#t.get(String(e))))}))}disconnectedCallback(){}has(t){return this.#t.has(t)}get(t){return x(this.#t.get(t))}set(t,e,s=!0){if(this.#t.has(t)){if(s){const s=this.#t.get(t);g(s)&&s.set(e)}}else this.#t.set(t,p(e)?e:b(e))}delete(t){return this.#t.delete(t)}signal(t){return this.#t.get(t)}first(t){return a(v(this).querySelector(t))}all(t){return Array.from(v(this).querySelectorAll(t))}}const C=(t,e)=>async function(n){await t.constructor.registry.whenDefined(n.localName);for(const[r,o]of Object.entries(e))n.set(r,p(o)?o:s(o)?b(o):t.signal(o));return n},N=(t,e,s)=>function(n){return n.addEventListener(t,(t=>this.set(e,(e=>s(t,e)??e)))),n},A=t=>[r(t[0])],E=t=>t.map((t=>parseInt(t,10))).filter(Number.isFinite),M=t=>t.map(parseFloat).filter(Number.isFinite),k=t=>t,$=t=>{let e=[];try{e=t.map((t=>JSON.parse(t)))}catch(t){l(t,"Failed to parse JSON",u)}return e},q=(t,e,s,r,o,i,c)=>{const a=i;return t.set(e,o,!1),m((o=>{if(t.has(e)){const i=t.get(e);n(i)?o(s,r,a):o(s,r,(t=>c(t))(i))}})),s},F=t=>function(e){const s=e.textContent||"",n=t=>()=>{Array.from(e.childNodes).filter(c).forEach((t=>t.remove())),e.append(document.createTextNode(t))};return q(this,t,e,`text ${String(t)}`,s,n(s),n)},L=(t,e=t)=>function(s){const n=e=>()=>s[t]=e;return q(this,e,s,`property ${String(t)}`,s[t],n(null),n)},O=(t,e=t)=>function(s){return q(this,e,s,`attribute ${String(t)}`,s.getAttribute(t),(()=>s.removeAttribute(t)),(e=>()=>s.setAttribute(t,e)))},T=(t,e=t)=>function(s){const n=e=>()=>s.toggleAttribute(t,e);return q(this,e,s,`attribute ${String(t)}`,s.hasAttribute(t),n(!1),n)},j=(t,e=t)=>function(s){return q(this,e,s,`class ${String(t)}`,s.classList.contains(t),(()=>s.classList.remove(t)),(e=>()=>s.classList.toggle(t,e)))},D=(t,e=t)=>function(s){return q(this,e,s,`style ${String(t)}`,s.style[t],(()=>s.style.removeProperty(t)),(e=>()=>s.style[t]=String(e)))};export{w as UIElement,A as asBoolean,E as asInteger,$ as asJSON,M as asNumber,k as asString,m as effect,l as log,a as maybe,N as on,C as pass,O as setAttribute,L as setProperty,D as setStyle,F as setText,T as toggleAttribute,j as toggleClass};
