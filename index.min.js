const t=t=>"function"==typeof t;let e;export const cause=s=>{const a=new WeakMap,n=t=>(!a.has(t)&&a.set(t,new Set),a.get(t)),r={get:()=>(e&&n(r).add(e),s),set:e=>{const a=s;if(s=t(e)?e(a):e,!Object.is(s,a))for(const t of n(r))t.get()}};return r};export const derive=t=>{const s={get:()=>{const a=e;e=s;const n=t();return e=a,n}};return s};export default class extends HTMLElement{static define(t,e=customElements){try{e.get(t)||e.define(t,this)}catch(t){console.error(t)}}attributeMap;#t=new Map;attributeChangedCallback(e,s,a){if(a!==s){const n=this.attributeMap?.get(e),[r,o]=Array.isArray(n)?n:[e,n],i={boolean:t=>"string"==typeof t,integer:t=>parseInt(t,10),number:t=>parseFloat(t)},c=t(o)?o:i[o];this.set(r,c?c(a,s):a)}}has(t){return this.#t.has(t)}get(t){return this.#t.get(t)?.get()}set(e,s,a=!0){if(this.#t.has(e)){const n=this.#t.get(e);a&&t(n.set)&&n.set(s)}else{const a="object"==typeof s&&t(s.get)?s:t(s)?derive(s):cause(s);this.#t.set(e,a)}}delete(t){return this.#t.delete(t)}pass(e,s,a=customElements){(async()=>{await a.whenDefined(e.localName);for(const[a,n]of s)e.set(a,t(n)?{get:n}:this.#t.get(n))})()}effect(e){requestAnimationFrame((()=>{const s=derive(e).get();t(s)&&s()}))}}