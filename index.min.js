/**
 * @name UIElement
 * @version 0.4.0
 * @license
 * Copyright 2024 Esther Brunner
 * SPDX-License-Identifier: BSD-3-Clause
 */
const t=t=>"function"==typeof t,e=(e,s=[],a=e)=>t(e)?e.call(...s):a;let s,a=!1;const n=new Set,r=new WeakMap,c=t=>(!r.has(t)&&r.set(t,new Set),r.get(t)),o=t=>{s&&c(t).add(s)},i=t=>{c(t).forEach((t=>t()))};export const cause=t=>{const s={get:()=>(o(s),t),set:a=>{const n=t;t=e(a,[s,n]),!Object.is(t,n)&&i(s)}};return s};export const compute=t=>{let e;const a={get:()=>{o(a);const n=e,r=s;return s=null,e=t(),s=r,!Object.is(e,n)&&i(a),e}};return a};export const effect=e=>{const r=()=>{s=r;const a=e();t(a)&&setTimeout(a),s=null};a?n.add(r):r()};export const batch=t=>{if(a)return t();a=!0,t(),n.forEach((t=>t())),n.clear(),a=!1};export default class extends HTMLElement{attributeMapping={};#t=new Map;attributeChangedCallback(t,s,a){if(a!==s){const n=this.attributeMapping[t],[r,c]=Array.isArray(n)?n:[t,n],o={boolean:t=>"string"==typeof t,integer:t=>parseInt(t,10),number:t=>parseFloat(t)},i=e(c,[this,a,s],o[c]?o[c](a):a);this.set(r,i)}}has(t){return this.#t.has(t)}get(t){return this.has(t)&&e(this.#t.get(t).get())}set(t,s){this.has(t)?e(this.#t.get(t).set,[this,s]):this.#t.set(t,cause(s))}delete(t){this.has(t)&&this.#t.delete(t)}effect(e){t(e)&&requestAnimationFrame((()=>effect(e)))}}