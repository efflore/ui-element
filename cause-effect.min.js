const t=(e="function",t=>typeof t===e);var e;let s;const n=t=>{for(const e of t)e.run()},o=e=>t(e)&&t(e.set),c=e=>{const c=()=>(s&&c.effects.add(s),e);return c.effects=new Set,c.set=s=>{const f=e;e=t(s)&&!o(s)?s(f):s,!Object.is(e,f)&&n(c.effects)},c},f=(t,e=!1)=>{let o,c=!0;const f=()=>{if(s&&f.effects.add(s),e&&!c)return o;const n=s;return s=f,o=t(),c=!1,s=n,o};return f.effects=new Set,f.run=()=>{c=!0,e&&n(f.effects)},f},r=e=>{const n=new Map,o=()=>{const c=s;s=o;const f=e(((t,e)=>{!n.has(t)&&n.set(t,new Set),n.get(t)?.add(e)}));for(const t of n.values())for(const e of t)e();s=c,t(f)&&queueMicrotask(f)};o.run=()=>o(),o.targets=n,o()};export{c as cause,f as derive,r as effect,o as isState};