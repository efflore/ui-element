const t=t=>e=>typeof e===t,e=t("object"),s=t("function"),n=t=>(t=>null!=t)(t)&&(e(t)||s(t)),c=(t,e)=>s(t[e]),o=t=>(t=>null==t)(t)?[]:[t],r=t=>({map:()=>r(t),fold:e=>e(t),catch:e=>e(t)}),a=t=>{try{return e=t(),{map:t=>a((()=>t(e))),fold:(t,s)=>s(e),catch:()=>{}}}catch(t){return r(t)}var e};let i;const l=t=>n(t)&&c(t,"set"),h=t=>l(t)||(t=>n(t)&&c(t,"run")&&"effects"in t)(t),u=t=>{const e=()=>(i&&e.effects.add(i),t);return e.effects=new Set,e.set=n=>{const c=t;t=s(n)&&!h(n)?n(t):n,Object.is(t,c)||(t=>{for(const e of t)e.run()})(e.effects)},e},f=t=>{const e=new Map,n=()=>{const c=i;i=n;const o=t(((t,s)=>{e.has(t)||e.set(t,new Set),e.get(t)?.add(s)}));for(const t of e.values()){for(const e of t)e.run();t.clear()}i=c,s(o)&&queueMicrotask(o)};n.run=()=>n(),n.targets=e,n()},d="context-request";class g extends Event{context;callback;subscribe;constructor(t,e,s=!1){super(d,{bubbles:!0,composed:!0}),this.context=t,this.callback=e,this.subscribe=s}}const b="error",p=(t,e,s="debug")=>((t=>"warn"===t||t===b)(s)&&console[s](e,t),t),m=(t,e)=>({elements:e,host:t,map:s=>m(t,e.map((e=>s(t,e))))}),x=t=>s(t)?x(t()):t,y=t=>t.shadowRoot||t;class w extends HTMLElement{static registry=customElements;static attributeMap={};static consumedContexts;static providedContexts;static define(t){a((()=>!this.registry.get(t)&&this.registry.define(t,this))).catch((e=>p(t,e.message,b)))}#t=new Map;attributeChangedCallback(t,e,n){if(n===e)return;const c=this.constructor.attributeMap[t];this.set(t,s(c)?c(o(n),this,e)[0]:n)}connectedCallback(){const t=this.constructor,e=t.consumedContexts||[];for(const t of e)this.set(String(t),void 0);setTimeout((()=>{for(const t of e)this.dispatchEvent(new g(t,(e=>this.set(String(t),e))))}));const n=t.providedContexts||[];n.length&&this.addEventListener(d,(t=>{const{context:e,callback:c}=t;n.includes(e)&&s(c)&&(t.stopPropagation(),c(this.#t.get(String(e))))}))}disconnectedCallback(){}has(t){return this.#t.has(t)}get(t){return x(this.#t.get(t))}set(t,e,s=!0){if(this.#t.has(t)){if(s){const s=this.#t.get(t);l(s)&&s.set(e)}}else this.#t.set(t,h(e)?e:u(e))}delete(t){return this.#t.delete(t)}first(t){return m(this,o(y(this).querySelector(t)))}all(t){return m(this,Array.from(y(this).querySelectorAll(t)))}async pass(t,e){if(await this.constructor.registry.whenDefined(t.localName),c(t,"set"))for(const[n,c]of Object.entries(e))t.set(n,h(c)?c:s(c)?u(c):this.#t.get(c));else p(t,"Expected UIElement",b)}signal(t){return this.#t.get(t)}}const v=t=>({run:()=>t()});export{w as UIElement,f as effect,v as io,o as maybe,m as ui};
