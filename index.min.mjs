/**
 * @license
 * Copyright 2024 Esther Brunner
 * SPDX-License-Identifier: BSD-3-Clause
 */
let t=null;const e=new WeakMap,s=t=>"function"==typeof t,a=t=>(!e.has(t)&&e.set(t,new Set),e.get(t));export default class extends HTMLElement{attributeMapping={};#t=new Map;attributeChangedCallback(t,e,a){if(a!==e){const r=e=>Array.isArray(e)?e:[t,e],[i,n]=r(this.attributeMapping[t]),h=()=>{if(s(n))return n.call(this,a,e);const t={boolean:t=>"string"==typeof t,integer:t=>parseInt(t,10),number:t=>parseFloat(t)};return t[n]?t[n](a):a};this.set(i,h())}}[Symbol.iterator](){return this.#t[Symbol.iterator]()}has(t){return this.#t.has(t)}get(t){if(this.#t.has(t))return this.#t.get(t)()}set(e,r){if(this.#t.has(e))this.#t.get(e).set(r);else{let i;if(Array.isArray(r)&&r[0]instanceof HTMLElement){const[t,e]=r;i=()=>t.get(e),i.set=s=>t.set(e,s)}else i=()=>(t&&a(i).add(t),s(r)?r():r),i.set=t=>{const e=r;(r=s(t)?t(r):t)!==e&&a(i).forEach((t=>t()))};this.#t.set(e,i)}}delete(t){this.#t.has(t)&&(this.#t.get(t).set(),this.#t.delete(t))}clear(){this.#t.forEach((t=>t.set())),this.#t.clear()}keys(){return this.#t.keys()}values(){return this.#t.values()}entries(){return this.#t.entries()}get size(){return this.#t.size}async effect(e){if(!s(e))throw new TypeError(`Effect handler in '${this.localName}' is not a function`);const a=()=>{t=a;const r=e();s(r)&&setTimeout(r),t=null};return requestAnimationFrame(a)}}