/**
 * @license
 * Copyright 2024 Esther Brunner
 * SPDX-License-Identifier: BSD-3-Clause
 */
let t=null;const e=new WeakMap,s=t=>"function"==typeof t,a=t=>(!e.has(t)&&e.set(t,new Set),e.get(t));export default class extends HTMLElement{attributeMapping={};#t=new Map;attributeChangedCallback(t,e,a){if(a!==e){const i=e=>Array.isArray(e)?e:[t,e],[n,r]=i(this.attributeMapping[t]),h=()=>{if(s(r))return r.call(this,a,e);const t={boolean:t=>"string"==typeof t,integer:t=>parseInt(t,10),number:t=>parseFloat(t)};return t[r]?t[r](a):a};this.set(n,h())}}[Symbol.iterator](){return this.#t[Symbol.iterator]()}has(t){return this.#t.has(t)}get(t,e=!1){if(!this.#t.has(t))return;const s=this.#t.get(t);return e?s:s()}set(e,i){if(this.#t.has(e))this.#t.get(e).set(i);else if(s(i)&&s(i.set))this.#t.set(e,i);else{const n=()=>(t&&a(n).add(t),s(i)?i():i);n.set=t=>{const e=i;(i=s(t)?t(i):t)!==e&&a(n).forEach((t=>t()))},this.#t.set(e,n)}}delete(t){this.#t.has(t)&&(this.#t.get(t).set(),this.#t.delete(t))}keys(){return this.#t.keys()}get size(){return this.#t.size}effect(e){if(!s(e))throw new TypeError(`Effect handler in '${this.localName}' is not a function`);const a=()=>{t=a;const i=e();s(i)&&setTimeout(i),t=null};requestAnimationFrame(a)}}